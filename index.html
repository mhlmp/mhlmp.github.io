<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>×× ×”×œ ×”×§×™×©×•×¨×™× - ×’×¨×¡×” ×™×¦×™×‘×”</title>
    <style>
        :root {
            /* ××©×ª× ×™ ×”×¢×™×¦×•×‘ ×”××§×•×¨×™×™× ×©×œ×š */
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --primary-text: #1c1e21;
            --secondary-text: #606770;
            --primary-color: #007bff;
            --primary-hover: #0056b3;
            --accent-color: #28a745;
            --accent-hover: #1e7e34;
            --danger-color: #d93025;
            --warn-color: #ffc107;
            --border-color: #ddd;
            --card-shadow: 0 2px 5px rgba(0, 0, 0, 0.07);
            --card-hover-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --light-note-bg: #fffbe6;
            --light-note-border: #ffe58f;
            --form-bg: #fcfcfc;
            --code-bg: #f8f8f8;
            --footer-bg: #f9f9f9;
            --category-bg: #e6f2ff;
        }
        .dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --primary-text: #ffffff;
            --secondary-text: #b0b3b8;
            --primary-color: #4da6ff;
            --primary-hover: #1e90ff;
            --accent-color: #66bb6a;
            --accent-hover: #388e3c;
            --danger-color: #ff7043;
            --warn-color: #ffeb3b;
            --border-color: #363636;
            --card-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            --card-hover-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            --light-note-bg: #33331a;
            --light-note-border: #808020;
            --form-bg: #2c2c2c;
            --code-bg: #2c2c2c;
            --footer-bg: #252525;
            --category-bg: #1e3a5f;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-text);
            margin: 0;
            padding: 10px;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden; /* ×× ×™×¢×ª ×’×œ×™×œ×” ××•×¤×§×™×ª ××™×•×ª×¨×ª */
        }

        h1 {
            text-align: center; font-size: 1.8rem; font-weight: 700;
            color: var(--primary-color); text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            margin-bottom: 10px; margin-top: 10px;
        }

        #itemCount {
            font-size: 0.9rem; font-weight: 600; color: var(--primary-text);
            background-color: var(--card-bg); padding: 5px 12px; border-radius: 8px;
            display: block; margin: 10px auto; text-align: center;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            width: fit-content; max-width: 95%;
        }
        
        /* --- Controls --- */
        #controls {
            background-color: var(--card-bg); padding: 15px; border-radius: 8px;
            box-shadow: var(--card-shadow); margin-bottom: 20px;
            display: flex; flex-direction: column; gap: 12px; border: 1px solid var(--border-color);
        }

        .controls-top { display: flex; gap: 10px; width: 100%; }
        .controls-bottom { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; justify-content: center; }

        #searchInput {
            flex-grow: 2; padding: 10px 15px; border: 1px solid var(--border-color);
            border-radius: 6px; font-size: 16px; background-color: var(--form-bg);
            color: var(--primary-text); min-width: 0;
        }
        
        #categoryFilter, #sortOrder {
            flex-grow: 1; padding: 10px; border: 1px solid var(--border-color);
            border-radius: 6px; font-size: 14px; background-color: var(--form-bg);
            color: var(--primary-text); max-width: 140px; cursor: pointer;
        }

        /* Buttons Style */
        #controls button, #importButtonLabel {
            color: white; border: none; padding: 10px 14px; border-radius: 6px;
            cursor: pointer; font-size: 13px; font-weight: 600;
            display: inline-flex; align-items: center; justify-content: center; gap: 5px;
            flex-grow: 1; transition: transform 0.1s, opacity 0.2s;
        }
        #controls button:active { transform: scale(0.98); }
        #controls button:hover { opacity: 0.9; }

        #exportBtn { background-color: var(--primary-color); }
        #toggleDarkModeBtn { background-color: #343a40; flex-grow: 0; }
        #importButtonLabel { background-color: var(--accent-color); margin: 0; }
        #exportTxtBtn { background-color: #17a2b8; }
        #downloadHtmlBtn { background-color: #6f42c1; }
        #downloadSourceTxtBtn { background-color: #fd7e14; }
        #toggleDuplicatesBtn { background-color: var(--warn-color); color: #333; }
        #deleteDuplicatesBtn { background-color: var(--danger-color); }
        #recycleBinBtn { background-color: #d63384; } /* ×›×¤×ª×•×¨ ×¡×œ ××—×–×•×¨ */
        
        #importFile { display: none; }

        /* --- Add Form --- */
        #formSection {
            background-color: var(--card-bg); border-radius: 8px;
            box-shadow: var(--card-shadow); margin-bottom: 20px;
            border: 1px solid var(--border-color); overflow: hidden;
        }
        #formSection summary {
            font-size: 1.1rem; font-weight: 600; padding: 15px;
            cursor: pointer; outline: none; user-select: none;
            color: var(--primary-color);
        }
        #addItemForm {
            display: grid; grid-template-columns: 1fr; gap: 15px; padding: 0 15px 15px 15px;
        }
        @media (min-width: 600px) {
            #addItemForm { grid-template-columns: 1fr 1fr; }
            .form-group.full-width { grid-column: 1 / -1; }
        }

        .form-group { display: flex; flex-direction: column; gap: 5px; }
        .form-group label { font-weight: 500; font-size: 14px; }
        .form-group input, .form-group textarea {
            padding: 10px; border: 1px solid var(--border-color);
            border-radius: 6px; font-size: 16px; background-color: var(--form-bg);
            color: var(--primary-text); font-family: inherit;
        }
        #addItemForm button {
            background-color: var(--accent-color); color: white; border: none;
            padding: 12px; border-radius: 6px; cursor: pointer;
            font-weight: 600; width: 100%; grid-column: 1 / -1;
        }

        /* --- List & Cards --- */
        .category-group { margin-bottom: 20px; }
        .category-title {
            font-size: 1.3rem; font-weight: 700; color: var(--primary-text);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px; margin-bottom: 10px;
            display: flex; justify-content: space-between;
        }
        
        .link-list {
            list-style-type: none; padding: 0; margin: 0;
            display: grid; gap: 10px; grid-template-columns: 1fr;
        }
        @media (min-width: 768px) {
            .link-list { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
        }

        .list-item {
            background-color: var(--card-bg); border-radius: 8px;
            box-shadow: var(--card-shadow); border: 1px solid var(--border-color);
            display: flex; flex-direction: column; position: relative;
            /* ×©×™× ×•×™: ×¨×§ ×¦×œ ××©×ª× ×” ×‘-Hover ×œ×× ×™×¢×ª ×¨×¢×™×“×•×ª */
            transition: box-shadow 0.2s; 
        }
        .list-item:hover { box-shadow: var(--card-hover-shadow); }
        
        .list-item.pinned { border-right: 4px solid var(--accent-color); background-color: var(--bg-color); }
        .list-item.duplicate { border-right: 4px solid var(--danger-color); }
        
        .item-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            padding: 12px 12px 5px 12px; gap: 8px;
        }
        .item-content { flex-grow: 1; overflow: hidden; word-break: break-all; }
        
        .item-link {
            font-size: 16px; color: var(--primary-color); text-decoration: none;
            font-weight: 600; display: block; line-height: 1.3;
        }
        .item-text {
            font-size: 14px; background: var(--code-bg); padding: 8px;
            border-radius: 4px; white-space: pre-wrap; word-break: break-all; margin: 0;
        }
        .item-date { font-size: 0.75rem; color: var(--secondary-text); margin-top: 4px; display: block; }
        .item-index { 
            font-size: 0.75rem; background: var(--border-color); color: var(--primary-text);
            padding: 1px 6px; border-radius: 4px; margin-right: 5px; font-weight: bold;
        }

        .item-body { padding: 0 12px 10px 12px; flex-grow: 1; }
        .item-description { font-size: 14px; color: var(--secondary-text); margin-top: 5px; }
        .item-note {
            font-size: 13px; background-color: var(--light-note-bg);
            border-right: 3px solid var(--light-note-border);
            padding: 6px 10px; margin-top: 8px; border-radius: 4px;
            color: #5d4037;
        }

        .item-footer {
            padding: 8px 12px; background-color: var(--footer-bg);
            border-top: 1px solid var(--border-color); border-radius: 0 0 8px 8px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .item-category {
            font-size: 11px; font-weight: 500; background-color: var(--category-bg);
            padding: 2px 8px; border-radius: 10px; color: var(--primary-color);
        }

        /* ×›×¤×ª×•×¨×™× ×‘×›×¨×˜×™×¡ */
        .item-actions { display: flex; gap: 5px; flex-shrink: 0; }
        .icon-btn {
            background: none; border: none; cursor: pointer;
            font-size: 18px; padding: 4px; width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; color: var(--secondary-text); transition: background 0.2s;
        }
        .icon-btn:hover { background-color: rgba(0,0,0,0.05); color: var(--primary-text); }
        .icon-btn.active { color: var(--accent-color); }
        .icon-btn.delete-btn:hover { color: var(--danger-color); background-color: rgba(217, 48, 37, 0.1); }

        /* Recycle Bin Modal */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: var(--card-bg); width: 90%; max-width: 600px; max-height: 80vh;
            border-radius: 8px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); display: flex; flex-direction: column;
        }
        .modal-header { padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 15px; overflow-y: auto; }
        .deleted-item {
            padding: 10px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;
        }

        #toast {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background-color: #333; color: white; padding: 10px 20px; border-radius: 20px;
            z-index: 3000; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #toast.show { opacity: 1; }

    </style>
</head>
<body>
    <h1>×× ×”×œ ×”×§×™×©×•×¨×™× <span id="itemCount">×˜×•×¢×Ÿ...</span></h1>
    
    <div id="controls">
        <div class="controls-top">
            <input type="search" id="searchInput" placeholder="×—×¤×© ×§×™×©×•×¨, ×ª×™××•×¨, #××¡×¤×¨...">
            <select id="categoryFilter"><option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option></select>
            <select id="sortOrder">
                <option value="date-new">×ª××¨×™×š (×—×“×©-×™×©×Ÿ)</option>
                <option value="date-old">×ª××¨×™×š (×™×©×Ÿ-×—×“×©)</option>
                <option value="name">×©× (×-×ª)</option>
            </select>
        </div>
        
        <div class="controls-bottom">
            <label for="importFile" id="importButtonLabel">ğŸ“¥ ×™×™×‘×•× JSON</label>
            <input type="file" id="importFile" accept=".json">
            <button id="exportBtn">ğŸ“¤ ×™×™×¦×•× JSON</button>
            <button id="exportTxtBtn">ğŸ“„ ×™×™×¦×•× TXT</button>
            <button id="downloadHtmlBtn">ğŸ’¾ ×©××•×¨ ××ª×¨ (HTML)</button>
            <button id="downloadSourceTxtBtn">ğŸ“œ ×§×•×“ ××§×•×¨ (TXT)</button>
            <button id="toggleDuplicatesBtn">âš ï¸ ×›×¤×™×œ×•×™×•×ª</button>
            <button id="deleteDuplicatesBtn">ğŸ—‘ï¸ ××—×§ ×›×¤×™×œ×•×™×•×ª</button>
            <button id="recycleBinBtn">ğŸ—‘ï¸ ×¡×œ ××—×–×•×¨</button>
            <button id="toggleDarkModeBtn">â˜€ï¸/ğŸŒ™</button>
        </div>
    </div>

    <details id="formSection">
        <summary>â• ×”×•×¡×£ ×¤×¨×™×˜ ×—×“×©</summary>
        <form id="addItemForm">
            <div class="form-group full-width">
                <label>×ª×•×›×Ÿ (×§×™×©×•×¨/×¤×§×•×“×”) *</label>
                <textarea id="itemContent" rows="2" required placeholder="×”×“×‘×§ ×›××Ÿ..."></textarea>
            </div>
            <div class="form-group full-width">
                <label>×ª×™××•×¨</label>
                <input type="text" id="itemDescription">
            </div>
            <div class="form-group">
                <label>×§×˜×’×•×¨×™×”</label>
                <input type="text" id="itemCategory" list="categoryList">
                <datalist id="categoryList"></datalist>
            </div>
            <div class="form-group">
                <label>×”×¢×¨×”</label>
                <input type="text" id="itemNote">
            </div>
            <button type="submit">×”×•×¡×£ ×œ×××’×¨</button>
        </form>
    </details>

    <div id="listContainer"></div>

    <div id="recycleBinModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>×¡×œ ××—×–×•×¨ (30 ×™×•×)</h3>
                <button onclick="document.getElementById('recycleBinModal').classList.remove('show')" style="background:none;border:none;font-size:1.5rem;cursor:pointer;">Ã—</button>
            </div>
            <div class="modal-body" id="recycleBinBody"></div>
        </div>
    </div>

    <div id="toast">×”×•×“×¢×”</div>

    <script id="app-state" type="application/json">[]</script>

    <script>
        const KEY = 'LinkManager_Source_Stable';
        const BIN_KEY = 'LinkManager_Bin';
        
        let items = [];
        let recycleBin = [];
        let hideDups = false;

        document.addEventListener('DOMContentLoaded', () => {
            // ×˜×¢×™× ×”
            try {
                const local = localStorage.getItem(KEY);
                if (local) {
                    const data = JSON.parse(local);
                    items = data.items || [];
                    recycleBin = data.recycleBin || [];
                } else {
                    // Fallback ×œ× ×ª×•× ×™× ××•×˜××¢×™× ×‘-HTML ×× ×™×©
                    const embedded = document.getElementById('app-state').textContent;
                    if(embedded.length > 5) items = JSON.parse(embedded);
                }
            } catch(e) { console.error(e); }

            // ××¦×‘ ×›×”×”
            if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark-mode');

            cleanupBin();
            renderList();

            // === Event Delegation (×”×œ×™×‘×” ×”×™×¦×™×‘×”) ===
            document.getElementById('listContainer').addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                if (!btn) return;
                const card = btn.closest('.list-item');
                if (!card) return;
                const id = parseFloat(card.dataset.id);

                if (btn.classList.contains('delete-btn')) moveToTrash(id);
                if (btn.classList.contains('copy-btn')) copyText(id);
                if (btn.classList.contains('edit-btn')) editItem(id);
                if (btn.classList.contains('pin-btn')) togglePin(id);
            });

            // Listeners
            document.getElementById('addItemForm').addEventListener('submit', addItem);
            document.getElementById('searchInput').addEventListener('input', () => renderList());
            document.getElementById('categoryFilter').addEventListener('change', () => renderList());
            document.getElementById('sortOrder').addEventListener('change', () => renderList());
            document.getElementById('toggleDarkModeBtn').addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            });
            document.getElementById('recycleBinBtn').addEventListener('click', openBin);
            document.getElementById('toggleDuplicatesBtn').addEventListener('click', () => {
                hideDups = !hideDups;
                renderList();
            });
            document.getElementById('deleteDuplicatesBtn').addEventListener('click', deleteDups);
            
            // Export/Import Listeners
            document.getElementById('exportBtn').addEventListener('click', () => downloadFile('links.json', JSON.stringify({items, recycleBin}), 'application/json'));
            document.getElementById('exportTxtBtn').addEventListener('click', () => {
                const txt = items.map(i => `${i.content} | ${i.description}`).join('\n');
                downloadFile('links.txt', txt, 'text/plain');
            });
            document.getElementById('downloadHtmlBtn').addEventListener('click', () => {
                document.getElementById('app-state').textContent = JSON.stringify(items);
                downloadFile('Manager.html', document.documentElement.outerHTML, 'text/html');
            });
            document.getElementById('downloadSourceTxtBtn').addEventListener('click', () => {
                downloadFile('source.txt', document.documentElement.outerHTML, 'text/plain');
            });
            document.getElementById('importFile').addEventListener('change', importFile);
        });

        // --- Logic ---
        function saveData() {
            localStorage.setItem(KEY, JSON.stringify({items, recycleBin}));
        }

        function cleanupBin() {
            const now = Date.now();
            recycleBin = recycleBin.filter(i => (now - i.deletedAt) < 30*24*60*60*1000);
            saveData();
        }

        function addItem(e) {
            e.preventDefault();
            const content = document.getElementById('itemContent').value.trim();
            if (!content) return;

            items.unshift({
                id: Date.now(),
                content: content,
                description: document.getElementById('itemDescription').value.trim(),
                category: document.getElementById('itemCategory').value.trim() || '×›×œ×œ×™',
                note: document.getElementById('itemNote').value.trim(),
                date: new Date().toISOString(),
                pinned: false
            });
            saveData();
            renderList();
            e.target.reset();
            showToast('× ×•×¡×£ ×‘×”×¦×œ×—×”');
        }

        function moveToTrash(id) {
            if (!confirm('×œ×”×¢×‘×™×¨ ×œ×¡×œ ×”××—×–×•×¨?')) return;
            const idx = items.findIndex(i => i.id === id);
            if (idx > -1) {
                const item = items[idx];
                item.deletedAt = Date.now();
                recycleBin.unshift(item);
                items.splice(idx, 1);
                saveData();
                renderList();
                showToast('×”×•×¢×‘×¨ ×œ×¡×œ');
            }
        }

        function togglePin(id) {
            const item = items.find(i => i.id === id);
            item.pinned = !item.pinned;
            saveData();
            renderList();
        }

        function editItem(id) {
            const item = items.find(i => i.id === id);
            const c = prompt("×¢×¨×•×š ×ª×•×›×Ÿ:", item.content);
            if(c !== null) {
                item.content = c;
                item.description = prompt("×ª×™××•×¨:", item.description) || '';
                item.category = prompt("×§×˜×’×•×¨×™×”:", item.category) || '×›×œ×œ×™';
                item.note = prompt("×”×¢×¨×”:", item.note) || '';
                saveData();
                renderList();
            }
        }

        function copyText(id) {
            const item = items.find(i => i.id === id);
            navigator.clipboard.writeText(item.content);
            showToast('×”×•×¢×ª×§!');
        }

        function deleteDups() {
            if(!confirm('×œ××—×•×§ ×›×¤×™×œ×•×™×•×ª?')) return;
            const seen = new Set();
            const newItems = [];
            items.forEach(i => {
                const k = i.content.toLowerCase().trim();
                if(!seen.has(k)) { seen.add(k); newItems.push(i); }
                else { i.deletedAt = Date.now(); recycleBin.unshift(i); }
            });
            items = newItems;
            saveData();
            renderList();
            showToast('×›×¤×™×œ×•×™×•×ª × ×•×§×•');
        }

        // --- Rendering ---
        function renderList() {
            const container = document.getElementById('listContainer');
            const search = document.getElementById('searchInput').value.toLowerCase();
            const cat = document.getElementById('categoryFilter').value;
            const sort = document.getElementById('sortOrder').value;

            // Categories
            const cats = [...new Set(items.map(i => i.category))].sort();
            const sel = document.getElementById('categoryFilter');
            if(sel.options.length === 1) {
                cats.forEach(c => sel.innerHTML += `<option value="${c}">${c}</option>`);
                document.getElementById('categoryList').innerHTML = cats.map(c => `<option value="${c}">`).join('');
            }

            // Filter
            let filtered = items.filter(i => {
                const txt = (i.content + i.description + i.category + i.note).toLowerCase();
                return txt.includes(search) && (!cat || i.category === cat);
            });

            // Handle #123 Search
            const numMatch = search.match(/^#(\d+)$/);
            
            // Sort
            filtered.sort((a, b) => {
                if(a.pinned !== b.pinned) return a.pinned ? -1 : 1;
                if(sort === 'date-new') return new Date(b.date) - new Date(a.date);
                if(sort === 'date-old') return new Date(a.date) - new Date(b.date);
                return a.content.localeCompare(b.content);
            });

            // If number search, limit to that index
            if(numMatch) {
                const idx = parseInt(numMatch[1]) - 1;
                if(filtered[idx]) filtered = [filtered[idx]];
                else filtered = [];
            }

            if(hideDups) {
                const seen = new Set();
                filtered = filtered.filter(i => seen.has(i.content) ? false : seen.add(i.content));
            }

            // Stats
            document.getElementById('itemCount').textContent = `××¦×™×’ ${filtered.length} ××ª×•×š ${items.length}`;
            container.innerHTML = '';

            // Grouping
            const groups = {};
            filtered.forEach(i => {
                if(!groups[i.category]) groups[i.category] = [];
                groups[i.category].push(i);
            });

            Object.keys(groups).sort().forEach(key => {
                const div = document.createElement('div');
                div.className = 'category-group';
                div.innerHTML = `<h2 class="category-title">${key} (${groups[key].length})</h2>`;
                const ul = document.createElement('ul');
                ul.className = 'link-list';
                
                groups[key].forEach(item => {
                    // ×”××™× ×“×§×¡ ×”×××™×ª×™ ×‘×¨×©×™××” ×”××¡×•× × ×ª
                    const realIndex = filtered.indexOf(item) + 1; 
                    ul.innerHTML += getCardHTML(item, realIndex);
                });
                
                div.appendChild(ul);
                container.appendChild(div);
            });
        }

        function getCardHTML(item, index) {
            const isLink = /^(http|t\.me)/.test(item.content);
            const content = isLink 
                ? `<a href="${item.content}" target="_blank" class="item-link">${item.content}</a>`
                : `<pre class="item-text">${item.content}</pre>`;
            
            return `
            <li class="list-item ${item.pinned ? 'pinned' : ''}" data-id="${item.id}">
                <div class="item-header">
                    <div class="item-content">
                        <span class="item-index">#${index}</span>
                        ${content}
                        <span class="item-date">${new Date(item.date).toLocaleDateString()}</span>
                    </div>
                    <div class="item-actions">
                        <button class="icon-btn copy-btn" title="×”×¢×ª×§">ğŸ“‹</button>
                        <button class="icon-btn pin-btn ${item.pinned?'active':''}" title="×”×¦××“">ğŸ“Œ</button>
                        <button class="icon-btn edit-btn" title="×¢×¨×•×š">âœï¸</button>
                        <button class="icon-btn delete-btn" title="××—×§">ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div class="item-body">
                    <div class="item-description">${item.description}</div>
                    ${item.note ? `<div class="item-note">${item.note}</div>` : ''}
                </div>
                <div class="item-footer">
                    <span class="item-category">${item.category}</span>
                </div>
            </li>`;
        }

        // --- Recycle Bin UI ---
        function openBin() {
            const body = document.getElementById('recycleBinBody');
            body.innerHTML = recycleBin.length ? '' : '<div style="text-align:center">×¨×™×§</div>';
            recycleBin.forEach(i => {
                body.innerHTML += `
                <div class="deleted-item">
                    <div>
                        <b>${i.content.substring(0,30)}...</b><br>
                        <small>× ××—×§: ${new Date(i.deletedAt).toLocaleDateString()}</small>
                    </div>
                    <div>
                        <button onclick="restore(${i.id})">â™»ï¸</button>
                        <button onclick="permDel(${i.id})" style="color:red">âŒ</button>
                    </div>
                </div>`;
            });
            document.getElementById('recycleBinModal').classList.add('show');
        }
        window.restore = (id) => {
            const idx = recycleBin.findIndex(i => i.id === id);
            delete recycleBin[idx].deletedAt;
            items.unshift(recycleBin[idx]);
            recycleBin.splice(idx, 1);
            saveData(); renderList(); openBin();
        };
        window.permDel = (id) => {
            if(confirm('×œ××—×•×§?')) {
                recycleBin = recycleBin.filter(i => i.id !== id);
                saveData(); openBin();
            }
        };

        // --- Utils ---
        function downloadFile(name, content, type) {
            const blob = new Blob([content], {type});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = name;
            a.click();
        }
        function importFile(e) {
            const r = new FileReader();
            r.onload = ev => {
                const d = JSON.parse(ev.target.result);
                items = d.items || d; 
                saveData(); renderList();
            };
            r.readAsText(e.target.files[0]);
        }
        function showToast(m) {
            const t = document.getElementById('toast');
            t.textContent = m; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
