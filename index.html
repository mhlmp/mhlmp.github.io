<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Link Manager Pro â€“ Ultimate Glass | Stable V6</title>

<!-- ================= STYLE ================= -->
<style>
:root{
  --bg:#0f172a;--fg:#f1f5f9;--card:#1e293b;--accent:#38bdf8
}
.light{
  --bg:#f8fafc;--fg:#020617;--card:#e5e7eb;--accent:#0284c7
}
body{
  margin:0;padding:16px;font-family:system-ui;
  background:var(--bg);color:var(--fg)
}
button,input,textarea{
  background:var(--card);color:var(--fg);
  border:none;border-radius:8px;padding:6px
}
.card{
  background:var(--card);
  border-radius:12px;
  padding:12px;
  margin:10px 0
}
.card small{opacity:.7}
.toast{
  position:fixed;bottom:16px;left:16px;
  background:#020617;color:#fff;
  padding:10px;border-radius:8px;display:none
}
</style>

<!-- ================= FIREBASE ================= -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

<h1>Link Manager Pro <small>Stable V6</small></h1>

<div>
  <input id="search" placeholder="×—×™×¤×•×©">
  <button onclick="toggleTheme()">ğŸŒ“</button>
  <button onclick="toggleDuplicates()">âš ï¸</button>
  <button onclick="exportJSON()">â¬‡ JSON</button>
  <button onclick="exportTXT()">â¬‡ TXT</button>
  <button onclick="downloadHTML()">â¬‡ HTML</button>
</div>

<form onsubmit="addItem(event)">
  <textarea id="content" required placeholder="×§×™×©×•×¨ ××• ×˜×§×¡×˜"></textarea>
  <input id="desc" placeholder="×ª×™××•×¨">
  <input id="cat" placeholder="×§×˜×’×•×¨×™×”">
  <button>×”×•×¡×£</button>
</form>

<div id="list"></div>

<div class="toast" id="toast">
  <span id="toastMsg"></span>
  <button onclick="undo()">×‘×˜×œ</button>
</div>

<script>
/* ================= CONFIG ================= */
const STORAGE='LM_PRO_V6'
const VERSION=6
const URL=/^(https?:\/\/|t\.me\/|@\w+)/i

/* ================= STATE ================= */
let items=[]
let undoStack=null
let showDup=true
let syncing=false

/* ================= FIREBASE ================= */
// ğŸ”‘ YOUR FIREBASE CONFIG
firebase.initializeApp({
  apiKey:"",
  authDomain:"",
  projectId:""
})
const auth=firebase.auth()
const db=firebase.firestore()

auth.signInAnonymously()

auth.onAuthStateChanged(u=>{
  if(u) syncFromCloud()
})

/* ================= STORAGE ================= */
function saveLocal(){
  localStorage.setItem(STORAGE,JSON.stringify({v:VERSION,items}))
}

function loadLocal(){
  const d=JSON.parse(localStorage.getItem(STORAGE)||'{}')
  items=Array.isArray(d.items)?d.items:[]
}

/* ================= CLOUD ================= */
function syncFromCloud(){
  db.collection('items').doc(auth.currentUser.uid)
  .onSnapshot(s=>{
    if(!s.exists||syncing) return
    const cloud=s.data().items||[]
    if(JSON.stringify(cloud)!==JSON.stringify(items)){
      items=cloud
      saveLocal();render()
    }
  })
}

function syncToCloud(){
  if(!auth.currentUser) return
  syncing=true
  db.collection('items')
    .doc(auth.currentUser.uid)
    .set({items})
    .finally(()=>syncing=false)
}

/* ================= CRUD ================= */
function addItem(e){
  e.preventDefault()
  const c=content.value.trim()
  if(!c) return
  items.unshift({
    id:crypto.randomUUID(),
    content:c,
    desc:desc.value,
    cat:cat.value||'×›×œ×œ×™',
    type:URL.test(c)?'link':'text',
    pinned:false,
    date:Date.now()
  })
  saveLocal();syncToCloud();render()
  e.target.reset()
}

function del(id){
  const i=items.findIndex(x=>x.id===id)
  undoStack={type:'del',item:items[i],i}
  items.splice(i,1)
  saveLocal();syncToCloud();render()
  toast('× ××—×§')
}

function pin(id){
  const x=items.find(i=>i.id===id)
  x.pinned=!x.pinned
  saveLocal();syncToCloud();render()
}

/* ================= RENDER ================= */
function render(){
  const q=search.value.toLowerCase()
  const map=new Map()
  items.forEach(i=>{
    const k=i.content.toLowerCase()
    i.dup=map.has(k);map.set(k,1)
  })
  let arr=items.filter(i=>{
    if(!showDup&&i.dup) return false
    return i.content.toLowerCase().includes(q)
  })
  arr.sort((a,b)=>{
    if(a.pinned&&!b.pinned) return -1
    if(!a.pinned&&b.pinned) return 1
    return b.date-a.date
  })
  list.innerHTML=''
  arr.forEach(i=>{
    const d=document.createElement('div')
    d.className='card'
    d.innerHTML=`
      ${i.type==='link'?`<a href="${i.content}" target="_blank">${i.content}</a>`:`<pre>${i.content}</pre>`}
      <div>${i.desc}</div>
      <small>${i.cat}</small>
      ${i.dup?' âš ï¸':''}
      <div>
        <button onclick="pin('${i.id}')">ğŸ“Œ</button>
        <button onclick="del('${i.id}')">ğŸ—‘ï¸</button>
      </div>`
    list.appendChild(d)
  })
}

/* ================= UTIL ================= */
function toggleTheme(){
  document.body.classList.toggle('light')
  localStorage.theme=document.body.className
}
function toggleDuplicates(){showDup=!showDup;render()}
function toast(t){
  toastMsg.textContent=t
  toast.style.display='block'
}
function undo(){
  if(!undoStack) return
  if(undoStack.type==='del')
    items.splice(undoStack.i,0,undoStack.item)
  undoStack=null
  saveLocal();syncToCloud();render()
  toast.style.display='none'
}

/* ================= EXPORT ================= */
function exportJSON(){
  download('items.json',JSON.stringify(items,null,2))
}
function exportTXT(){
  download('items.txt',items.map(i=>i.content).join('\n'))
}
function downloadHTML(){
  download('index.html',document.documentElement.outerHTML)
}
function download(n,c){
  const a=document.createElement('a')
  a.href=URL.createObjectURL(new Blob([c]))
  a.download=n;a.click()
}

/* ================= INIT ================= */
loadLocal()
if(localStorage.theme==='light') document.body.className='light'
render()
</script>
</body>
</html>
