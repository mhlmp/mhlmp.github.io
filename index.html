<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <title>Link Manager Pro</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/jpeg" href="icon.jpg">
    
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.6);
            --glass-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            --glass-blur: blur(10px);
            --text-primary: #1a1a1a;
            --text-secondary: #555555;
            --primary-color: #0066cc;
            --primary-glow: rgba(0, 102, 204, 0.2);
            --radius: 12px;
            --accent-green: #00a651;
            --accent-red: #d93025;
            --accent-gold: #f59e0b;
            --note-bg: rgba(255, 248, 220, 0.9);
            --google-btn: #4285F4;
        }

        body.dark-mode {
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --glass-bg: rgba(30, 41, 59, 0.85); 
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --primary-color: #60a5fa;
            --primary-glow: rgba(96, 165, 250, 0.2);
            --note-bg: rgba(60, 50, 30, 0.8);
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-primary);
            margin: 0;
            padding: 15px;
            padding-bottom: 100px;
            min-height: 100vh;
            transition: color 0.3s;
        }

        /* Glassmorphism Classes */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: var(--radius);
        }

        header { text-align: center; margin-bottom: 25px; }
        h1 { margin: 5px 0; font-size: 1.8rem; font-weight: 800; }
        
        #connectionStatus {
            display: inline-block; 
            background: rgba(127, 127, 127, 0.1); 
            padding: 4px 15px;
            border-radius: 20px; font-size: 0.9rem; color: var(--text-secondary);
            border: 1px solid var(--glass-border); font-weight: 600;
        }

        /* User UI */
        #userSection { padding: 12px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .user-avatar { width: 42px; height: 42px; border-radius: 50%; border: 2px solid var(--glass-border); object-fit: cover; }
        .user-name { font-weight: 700; font-size: 1rem; }
        
        .btn-login { background: var(--google-btn); color: white; border: none; padding: 10px 24px; border-radius: 30px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 10px rgba(66, 133, 244, 0.3); }
        .btn-action-sm { background: rgba(127,127,127,0.1); border: 1px solid var(--glass-border); color: var(--text-primary); padding: 8px 14px; border-radius: 8px; cursor: pointer; margin-left: 5px; }

        /* Welcome & Protect */
        #welcomeScreen { display: none; flex-direction: column; align-items: center; text-align: center; padding: 40px 20px; margin-top: 20px; }
        #welcomeScreen.visible { display: flex; }
        .lock-icon { font-size: 4rem; margin-bottom: 20px; opacity: 0.8; }
        
        .auth-required { transition: opacity 0.3s ease; }
        .auth-required.locked { display: none !important; }

        /* Controls */
        #controlsArea { padding: 16px; margin-bottom: 25px; display: flex; flex-direction: column; gap: 14px; position: relative; z-index: 100; }
        .search-container input { width: 100%; padding: 12px 16px; font-size: 16px; border: 1px solid var(--glass-border); border-radius: var(--radius); background: rgba(127,127,127,0.1); color: var(--text-primary); }
        .filters-container { display: flex; gap: 10px; flex-wrap: wrap; }
        .filters-container select { flex: 1; height: 44px; padding: 0 12px; background: rgba(127,127,127,0.1); color: var(--text-primary); border: 1px solid var(--glass-border); border-radius: var(--radius); }
        .filters-container select option { background: #1e293b; color: white; }

        .actions-bar { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
        .action-btn { flex: 1; height: 44px; color: white; border: none; border-radius: var(--radius); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: 600; }
        .btn-json { background: linear-gradient(135deg, #2563eb, #1d4ed8); }
        .btn-trash { background: linear-gradient(135deg, #64748b, #475569); }
        .btn-icon-only { width: 44px; flex: 0 0 44px; background: rgba(127,127,127,0.1); border: 1px solid var(--glass-border); color: var(--text-primary); }

        /* Add Item Form */
        details { margin-bottom: 25px; }
        summary { padding: 16px; cursor: pointer; font-weight: 700; color: var(--primary-color); background: rgba(127,127,127,0.05); list-style: none; display: flex; justify-content: center; border-radius: var(--radius); }
        #addItemForm { padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        #addItemForm input, #addItemForm textarea { padding: 12px; border: 1px solid var(--glass-border); border-radius: var(--radius); background: rgba(127,127,127,0.05); color: var(--text-primary); width: 100%; }
        #addItemForm button { background: var(--accent-green); color: white; padding: 14px; border: none; border-radius: var(--radius); font-weight: bold; cursor: pointer; }

        /* Cards Grid */
        .items-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .category-header { margin: 30px 0 15px 0; border-bottom: 2px solid rgba(127,127,127,0.1); padding-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }

        .card { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius); display: flex; flex-direction: column; position: relative; transition: transform 0.2s; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .card.pinned { border: 2px solid var(--accent-gold); background: rgba(255, 215, 0, 0.05); }
        
        .card-body { padding: 20px; padding-top: 35px; flex-grow: 1; }
        .card-link { display: block; color: var(--primary-color); font-weight: 700; text-decoration: none; margin-bottom: 8px; word-break: break-all; font-size: 1.1em; }
        .card-desc { font-size: 0.95em; opacity: 0.9; margin-bottom: 10px; line-height: 1.4; }
        .card-note { background: var(--note-bg); color: #4a3b10; padding: 8px; border-radius: 6px; font-size: 0.85em; margin-top: 10px; border-right: 3px solid var(--accent-gold); }
        
        .card-footer { padding: 10px 15px; background: rgba(127,127,127,0.05); border-top: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; border-radius: 0 0 var(--radius) var(--radius); }
        .card-actions button { background: none; border: none; cursor: pointer; font-size: 1.1em; padding: 5px; border-radius: 50%; transition: background 0.2s; opacity: 0.7; }
        .card-actions button:hover { background: rgba(127,127,127,0.2); opacity: 1; }
        .pin-active { color: var(--accent-gold); opacity: 1 !important; }

        /* Trash Modal */
        #trashModal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 2000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        #trashModal.open { display: flex; }
        .modal-content { background: var(--glass-bg); width: 90%; max-width: 600px; max-height: 80vh; border-radius: var(--radius); display: flex; flex-direction: column; overflow: hidden; border: 1px solid var(--glass-border); }
        .modal-body { padding: 20px; overflow-y: auto; }
        .trash-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid var(--glass-border); }

        /* Toast */
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translate(-50%, 100px); background: #1e293b; color: white; padding: 12px 24px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); opacity: 0; transition: 0.3s; z-index: 3000; border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 15px; }
        #toast.visible { transform: translate(-50%, 0); opacity: 1; }
    </style>
</head>
<body class="dark-mode">

    <header>
        <h1>Link Manager Pro</h1>
        <div id="connectionStatus">×××ª×™×Ÿ ×œ×”×ª×—×‘×¨×•×ª...</div>
    </header>

    <div id="userSection" class="glass-panel">
        <div id="loggedOutView" style="display:flex; width:100%; justify-content:center;">
            <button id="googleLoginBtn" class="btn-login">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" alt="G">
                ×”×ª×—×‘×¨ ×¢× Google
            </button>
        </div>
        <div id="loggedInView" style="display:none; width:100%; justify-content:space-between; align-items:center;">
            <div class="user-info">
                <img id="userAvatar" src="" class="user-avatar" alt="Avatar">
                <div>
                    <div id="userName" class="user-name">××©×ª××©</div>
                    <div style="font-size:0.8em; opacity:0.7">××—×•×‘×¨ ×œ×¢× ×Ÿ ×¤×¨×˜×™</div>
                </div>
            </div>
            <button id="logoutBtn" class="btn-action-sm">×™×¦×™××”</button>
        </div>
    </div>

    <div id="welcomeScreen" class="visible">
        <div class="lock-icon">ğŸ”’</div>
        <h2>×”××™×“×¢ ×©×œ×š ×¤×¨×˜×™</h2>
        <p>×”××¢×¨×›×ª ×©×•××¨×ª ××ª ×”×§×™×©×•×¨×™× ×©×œ×š <b>××š ×•×¨×§</b> ×‘×—×©×‘×•×Ÿ Google ×”×¤×¨×˜×™ ×©×œ×š.</p>
        <p>×‘×¢×ª ×™×¦×™××” (Logout), ×›×œ ×”× ×ª×•× ×™× × ××—×§×™× ××™×™×“×™×ª ××”××›×©×™×¨ ×”×–×”.</p>
    </div>

    <div id="protectedContent" class="auth-required locked">
        <div id="controlsArea" class="glass-panel">
            <div class="search-container">
                <input type="search" id="searchInput" placeholder="ğŸ” ×—×™×¤×•×© ××”×™×¨...">
            </div>

            <div class="filters-container">
                <select id="categoryFilter"><option value="">ğŸ“‚ ×›×œ ×”×§×˜×’×•×¨×™×•×ª</option></select>
                <select id="sortOrder">
                    <option value="newest">ğŸ“… ×—×“×© ×œ×™×©×Ÿ</option>
                    <option value="name">ğŸ”¤ ×œ×¤×™ ×-×‘</option>
                </select>
            </div>

            <div class="actions-bar">
                <button id="exportBtn" class="action-btn btn-json">ğŸ“¤ ×™×™×¦×•× JSON</button>
                <button id="trashBtn" class="action-btn btn-trash">ğŸ—‘ï¸ ×¡×œ ××—×–×•×¨</button>
                <button id="darkModeBtn" class="action-btn btn-icon-only">â˜€ï¸</button>
            </div>
        </div>

        <details class="glass-panel">
            <summary>â• ×”×•×¡×¤×ª ×§×™×©×•×¨ ×—×“×©</summary>
            <form id="addItemForm">
                <textarea id="itemContent" rows="2" required placeholder="×”×“×‘×§ ×›××Ÿ ×§×™×©×•×¨ (URL) ××• ×˜×§×¡×˜..."></textarea>
                <input type="text" id="itemDescription" placeholder="×ª×™××•×¨ ×§×¦×¨">
                <input type="text" id="itemCategory" list="catList" placeholder="×§×˜×’×•×¨×™×” (×œ×“×•×’××”: ×¢×‘×•×“×”, ×œ×™××•×“×™×)">
                <datalist id="catList"></datalist>
                <input type="text" id="itemNote" placeholder="×”×¢×¨×” (××•×¤×¦×™×•× ×œ×™)">
                <button type="submit">×©××•×¨ ×‘×¢× ×Ÿ</button>
            </form>
        </details>

        <div id="listContainer"></div>
    </div>

    <div id="trashModal">
        <div class="modal-content">
            <div style="padding:15px; border-bottom:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between;">
                <h3>×¡×œ ××—×–×•×¨</h3>
                <button onclick="document.getElementById('trashModal').classList.remove('open')" style="background:none; border:none; color:white; font-size:1.5em; cursor:pointer;">&times;</button>
            </div>
            <div id="trashList" class="modal-body"></div>
        </div>
    </div>

    <div id="toast">×”×•×“×¢×”</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // === FIREBASE CONFIGURATION ===
        const firebaseConfig = {
            apiKey: "AIzaSyDwofGCJUWkdLGWyXK7_UBAbbC39FXnAmI",
            authDomain: "linkmeir-dada4.firebaseapp.com",
            projectId: "linkmeir-dada4",
            storageBucket: "linkmeir-dada4.firebasestorage.app",
            messagingSenderId: "933486826829",
            appId: "1:933486826829:web:6e61498d88a55623c65304",
            measurementId: "G-46D3WMVFK5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // === STATE MANAGEMENT ===
        let currentUser = null;
        let items = [];
        let trash = [];
        let unsubscribe = null;

        // === INITIALIZATION ===
        document.addEventListener('DOMContentLoaded', () => {
            initServiceWorker();
            setupEventListeners();
            checkTheme();
        });

        function initServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered'))
                    .catch(err => console.error('SW Error:', err));
            }
        }

        // === AUTH & PRIVACY LOGIC ===
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // USER LOGGED IN
                currentUser = user;
                updateUI(true);
                startCloudSync(user);
            } else {
                // USER LOGGED OUT
                currentUser = null;
                // CRITICAL: WIPE DATA
                items = [];
                trash = [];
                unsubscribe && unsubscribe();
                localStorage.removeItem(`LinkMeir_Cache`); // Wipe local cache
                updateUI(false);
            }
        });

        function startCloudSync(user) {
            const userRef = doc(db, "users", user.uid);
            document.getElementById('connectionStatus').textContent = "××¡× ×›×¨×Ÿ...";
            
            // Listen for real-time updates from Google Cloud
            unsubscribe = onSnapshot(userRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    items = data.items || [];
                    trash = data.trash || [];
                    
                    // Optional: Cache locally only for offline resilience while logged in
                    localStorage.setItem(`LinkMeir_Cache`, JSON.stringify(data));
                } else {
                    // New user doc
                    setDoc(userRef, { items: [], trash: [] });
                }
                document.getElementById('connectionStatus').textContent = `${items.length} ×¤×¨×™×˜×™×`;
                renderApp();
            }, (error) => {
                console.error("Sync Error", error);
                document.getElementById('connectionStatus').textContent = "×©×’×™××ª ×¡× ×›×¨×•×Ÿ";
            });
        }

        async function login() {
            const provider = new GoogleAuthProvider();
            try { await signInWithPopup(auth, provider); } catch (e) { alert("×”×ª×—×‘×¨×•×ª × ×›×©×œ×”: " + e.message); }
        }

        async function logout() {
            if (confirm("×”×× ××ª×” ×‘×˜×•×—? ×›×œ ×”× ×ª×•× ×™× ×™×™××—×§×• ××”××›×©×™×¨ ×”× ×•×›×—×™ (××š ×™×™×©××¨×• ×‘×¢× ×Ÿ).")) {
                await signOut(auth);
                window.location.reload(); // Hard refresh to clear memory
            }
        }

        // === DATA OPERATIONS ===
        async function saveToCloud() {
            if (!currentUser) return;
            try {
                await setDoc(doc(db, "users", currentUser.uid), {
                    items: items,
                    trash: trash,
                    lastUpdated: new Date().toISOString()
                });
            } catch (e) {
                showToast("×©×’×™××” ×‘×©××™×¨×” ×‘×¢× ×Ÿ!");
            }
        }

        function addItem(e) {
            e.preventDefault();
            const content = document.getElementById('itemContent').value.trim();
            if (!content) return;

            const isUrl = /^(http|https):\/\/[^ "]+$/.test(content);
            
            const newItem = {
                id: Date.now(),
                content: content,
                description: document.getElementById('itemDescription').value.trim(),
                category: document.getElementById('itemCategory').value.trim() || '×›×œ×œ×™',
                note: document.getElementById('itemNote').value.trim(),
                date: new Date().toISOString(),
                type: isUrl ? 'link' : 'text',
                isPinned: false
            };

            items.unshift(newItem);
            saveToCloud();
            e.target.reset();
            renderApp();
            showToast("× ×©××¨ ×‘×”×¦×œ×—×” âœ…");
        }

        window.deleteItem = function(id) {
            const index = items.findIndex(i => i.id === id);
            if (index > -1) {
                const item = items[index];
                item.deletedAt = new Date().toISOString();
                trash.unshift(item);
                items.splice(index, 1);
                saveToCloud();
                renderApp();
                showToast("×”×•×¢×‘×¨ ×œ×¡×œ ×”××—×–×•×¨ ğŸ—‘ï¸");
            }
        };

        window.togglePin = function(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                item.isPinned = !item.isPinned;
                saveToCloud();
                renderApp();
            }
        };

        // === UI RENDERING ===
        function renderApp() {
            const container = document.getElementById('listContainer');
            const search = document.getElementById('searchInput').value.toLowerCase();
            const catFilter = document.getElementById('categoryFilter').value;
            const sortOrder = document.getElementById('sortOrder').value;

            // Filter
            let filtered = items.filter(i => {
                const matchSearch = i.content.toLowerCase().includes(search) || 
                                    i.description.toLowerCase().includes(search) ||
                                    i.category.toLowerCase().includes(search);
                const matchCat = catFilter ? i.category === catFilter : true;
                return matchSearch && matchCat;
            });

            // Sort
            filtered.sort((a, b) => {
                if (a.isPinned !== b.isPinned) return a.isPinned ? -1 : 1; // Pinned first
                if (sortOrder === 'newest') return b.date.localeCompare(a.date);
                return a.content.localeCompare(b.content);
            });

            // Update Categories Dropdown
            const categories = [...new Set(items.map(i => i.category))].sort();
            const catSelect = document.getElementById('categoryFilter');
            const dataList = document.getElementById('catList');
            
            // Save selection
            const currentCat = catSelect.value;
            catSelect.innerHTML = '<option value="">ğŸ“‚ ×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>' + 
                categories.map(c => `<option value="${c}">${c}</option>`).join('');
            catSelect.value = currentCat;
            dataList.innerHTML = categories.map(c => `<option value="${c}">`).join('');

            // Render Grid
            container.innerHTML = '';
            
            if (filtered.length === 0) {
                container.innerHTML = `<div style="text-align:center; opacity:0.5; grid-column:1/-1; margin-top:30px;">×œ× × ××¦××• ×¤×¨×™×˜×™×</div>`;
                return;
            }

            // Grouping logic could go here, but grid is cleaner for now
            const grid = document.createElement('div');
            grid.className = 'items-grid';
            
            filtered.forEach(item => {
                const el = document.createElement('div');
                el.className = `card ${item.isPinned ? 'pinned' : ''}`;
                
                let contentHtml = item.type === 'link' 
                    ? `<a href="${item.content}" target="_blank" class="card-link">${escapeHtml(item.content)}</a>`
                    : `<div class="card-link" onclick="navigator.clipboard.writeText('${escapeHtml(item.content)}'); showToast('×”×•×¢×ª×§')">${escapeHtml(item.content)}</div>`;

                el.innerHTML = `
                    <div class="card-body">
                        <div style="font-size:0.8em; opacity:0.6; margin-bottom:5px;">${escapeHtml(item.category)}</div>
                        ${contentHtml}
                        <div class="card-desc">${escapeHtml(item.description)}</div>
                        ${item.note ? `<div class="card-note">ğŸ“ ${escapeHtml(item.note)}</div>` : ''}
                    </div>
                    <div class="card-footer">
                        <small style="opacity:0.6">${new Date(item.date).toLocaleDateString('he-IL')}</small>
                        <div class="card-actions">
                            <button onclick="togglePin(${item.id})" title="× ×¢×¥/×‘×˜×œ × ×¢×™×¦×”" class="${item.isPinned ? 'pin-active' : ''}">ğŸ“Œ</button>
                            <button onclick="navigator.clipboard.writeText('${escapeHtml(item.content)}'); showToast('×”×•×¢×ª×§')" title="×”×¢×ª×§">ğŸ“‹</button>
                            <button onclick="deleteItem(${item.id})" title="××—×§">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
                grid.appendChild(el);
            });
            container.appendChild(grid);
        }

        // === UTILS ===
        function updateUI(loggedIn) {
            document.getElementById('loggedOutView').style.display = loggedIn ? 'none' : 'flex';
            document.getElementById('loggedInView').style.display = loggedIn ? 'flex' : 'none';
            document.getElementById('welcomeScreen').classList.toggle('visible', !loggedIn);
            document.getElementById('protectedContent').classList.toggle('locked', !loggedIn);
            
            if (loggedIn && currentUser) {
                document.getElementById('userName').textContent = currentUser.displayName;
                document.getElementById('userAvatar').src = currentUser.photoURL;
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;");
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('visible');
            setTimeout(() => t.classList.remove('visible'), 3000);
        }

        function setupEventListeners() {
            document.getElementById('googleLoginBtn').addEventListener('click', login);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('addItemForm').addEventListener('submit', addItem);
            document.getElementById('searchInput').addEventListener('input', renderApp);
            document.getElementById('categoryFilter').addEventListener('change', renderApp);
            document.getElementById('sortOrder').addEventListener('change', renderApp);
            
            // Trash & Export
            document.getElementById('trashBtn').addEventListener('click', () => {
                const list = document.getElementById('trashList');
                list.innerHTML = trash.length ? '' : '<div style="text-align:center">×¨×™×§</div>';
                trash.forEach((item, idx) => {
                    const div = document.createElement('div');
                    div.className = 'trash-item';
                    div.innerHTML = `<div>${escapeHtml(item.description || item.content)}</div>
                                     <button onclick="restoreItem(${idx})">â™»ï¸</button>`;
                    list.appendChild(div);
                });
                document.getElementById('trashModal').classList.add('open');
            });

            window.restoreItem = function(index) {
                const item = trash.splice(index, 1)[0];
                delete item.deletedAt;
                items.unshift(item);
                saveToCloud();
                renderApp();
                document.getElementById('trashModal').classList.remove('open');
            };

            document.getElementById('exportBtn').addEventListener('click', () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(items));
                const node = document.createElement('a');
                node.href = dataStr;
                node.download = "linkmeir_backup.json";
                node.click();
            });

            document.getElementById('darkModeBtn').addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            });
        }

        function checkTheme() {
            if (localStorage.getItem('theme') === 'light') {
                document.body.classList.remove('dark-mode');
            }
        }
    </script>
</body>
</html>
